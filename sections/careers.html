<section id="careers" class="careers-section">
    <div class="container">
        <h2 class="section-title" id="careers-title">Join Our Team</h2>
        <p class="section-subtitle" id="careers-subtitle">Building the future of AI from first principles</p>
        
        <div class="careers-grid" id="careers-grid">
            <!-- ì±„ìš© ê³µê³ ë“¤ì´ JavaScriptë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
        
        <div class="careers-cta" id="careers-cta">
            <!-- CTA ì„¹ì…˜ì´ JavaScriptë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
    </div>
</section>

<!-- Job Application Modal -->
<div id="jobModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeJobModal()">&times;</span>
        <h2 id="modalJobTitle">Apply for Position</h2>
        
        <form id="jobApplicationForm" class="job-form">
            <input type="hidden" id="jobPosition" name="position">
            
            <div class="form-group">
                <label for="applicantName" id="label-fullName">ì´ë¦„ *</label>
                <input type="text" id="applicantName" name="name" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label for="applicantEmail" id="label-email">ì´ë©”ì¼ì£¼ì†Œ *</label>
                <input type="email" id="applicantEmail" name="email" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label for="applicantPhone" id="label-phone">ì „í™”ë²ˆí˜¸ *</label>
                <input type="tel" id="applicantPhone" name="phone" class="form-input" required>
            </div>
            
            <div class="form-group">
                <label for="applicantGithub" id="label-github">GitHub Profile *</label>
                <input type="url" id="applicantGithub" name="github" class="form-input" placeholder="https://github.com/your-username" required>
            </div>
            
            <div class="form-group">
                <label for="applicantMessage" id="label-message">í•˜ê³ ì‹¶ì€ë§ *</label>
                <textarea id="applicantMessage" name="message" class="form-textarea" rows="4" placeholder="ìê¸°ì†Œê°œë‚˜ ì§€ì› ë™ê¸° ë“±ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”" required></textarea>
            </div>
            

            
            <button type="submit" class="submit-btn" id="submit-btn">
                <span class="loading-spinner"></span>
                <span class="btn-text">Submit Application</span>
            </button>
            
            <div class="form-message" id="jobFormMessage"></div>
        </form>
    </div>
</div>

<script>
let careersData = null;

// JSON ë°ì´í„° ë¡œë“œ
async function loadCareersData() {
    try {
        const response = await fetch('./json/careers.json');
        careersData = await response.json();
        renderCareers();
        updateCareersLanguage();
    } catch (error) {
        console.error('ì±„ìš© ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        // í´ë°±ìœ¼ë¡œ ê¸°ë³¸ ì±„ìš© êµ¬ì¡° ìƒì„±
        createFallbackCareers();
    }
}

// ì±„ìš© ì„¹ì…˜ ë Œë”ë§
function renderCareers() {
    if (!careersData) return;
    
    renderJobCards();
    renderCTA();
}

// ì±„ìš© ê³µê³  ì¹´ë“œ ë Œë”ë§
function renderJobCards() {
    const careersGrid = document.getElementById('careers-grid');
    careersGrid.innerHTML = '';
    
    careersData.jobs.forEach(job => {
        const jobElement = createJobCardElement(job);
        careersGrid.appendChild(jobElement);
    });
}

// ì±„ìš© ê³µê³  ì¹´ë“œ ìš”ì†Œ ìƒì„±
function createJobCardElement(job) {
    const jobDiv = document.createElement('div');
    jobDiv.className = 'job-card';
    
    const currentLang = window.currentLanguage || localStorage.getItem('language') || 'ko';
    const requirementsList = job.requirements[currentLang]
        .map(req => `<li>${req}</li>`)
        .join('');
    
    jobDiv.innerHTML = `
        <h3 data-title-en="${job.title.en}" data-title-ko="${job.title.ko}">${job.title[currentLang]}</h3>
        <div class="job-type" data-type-en="${job.type.en}" data-type-ko="${job.type.ko}">${job.type[currentLang]}</div>
        <p data-desc-en="${job.description.en}" data-desc-ko="${job.description.ko}">${job.description[currentLang]}</p>
        <ul class="job-requirements" data-job-id="${job.id}">
            ${requirementsList}
        </ul>
        <button class="apply-btn" onclick="openJobModal('${job.id}')" 
                data-apply-en="${careersData.modal.form.applyNowButton.en}" 
                data-apply-ko="${careersData.modal.form.applyNowButton.ko}">
            ${careersData.modal.form.applyNowButton[currentLang]}
        </button>
    `;
    
    return jobDiv;
}

// CTA ì„¹ì…˜ ë Œë”ë§
function renderCTA() {
    const currentLang = window.currentLanguage || localStorage.getItem('language') || 'ko';
    const ctaElement = document.getElementById('careers-cta');
    ctaElement.innerHTML = `
        <h3 data-cta-title-en="${careersData.cta.title.en}" data-cta-title-ko="${careersData.cta.title.ko}">
            ${careersData.cta.title[currentLang]}
        </h3>
        <p data-cta-desc-en="${careersData.cta.description.en}" data-cta-desc-ko="${careersData.cta.description.ko}">
            ${careersData.cta.description[currentLang]}
        </p>
        <a href="#contact" class="cta-button" 
           data-cta-btn-en="${careersData.cta.buttonText.en}" 
           data-cta-btn-ko="${careersData.cta.buttonText.ko}">
            ${careersData.cta.buttonText[currentLang]}
        </a>
    `;
}

// ì±„ìš© ì–¸ì–´ ì—…ë°ì´íŠ¸
function updateCareersLanguage() {
    if (!careersData) return;
    
    const currentLang = window.currentLanguage || localStorage.getItem('language') || 'ko';
    
    // ì œëª© ë° ë¶€ì œëª© ì—…ë°ì´íŠ¸
    const titleElement = document.getElementById('careers-title');
    const subtitleElement = document.getElementById('careers-subtitle');
    
    if (titleElement) {
        titleElement.textContent = careersData.title[currentLang];
    }
    if (subtitleElement) {
        subtitleElement.textContent = careersData.subtitle[currentLang];
    }
    
    // ì±„ìš© ê³µê³  ì¹´ë“œ ì—…ë°ì´íŠ¸
    updateJobCards();
    
    // CTA ì„¹ì…˜ ì—…ë°ì´íŠ¸
    updateCTA();
    
    // ëª¨ë‹¬ í¼ ë¼ë²¨ ì—…ë°ì´íŠ¸
    updateModalLabels();
}

// ì±„ìš© ê³µê³  ì¹´ë“œ ì–¸ì–´ ì—…ë°ì´íŠ¸
function updateJobCards() {
    const currentLang = window.currentLanguage || localStorage.getItem('language') || 'ko';
    
    // ì œëª© ì—…ë°ì´íŠ¸
    document.querySelectorAll('[data-title-en]').forEach(element => {
        const titleEn = element.getAttribute('data-title-en');
        const titleKo = element.getAttribute('data-title-ko');
        if (titleEn && titleKo) {
            element.textContent = currentLang === 'ko' ? titleKo : titleEn;
        }
    });
    
    // íƒ€ì… ì—…ë°ì´íŠ¸
    document.querySelectorAll('[data-type-en]').forEach(element => {
        const typeEn = element.getAttribute('data-type-en');
        const typeKo = element.getAttribute('data-type-ko');
        if (typeEn && typeKo) {
            element.textContent = currentLang === 'ko' ? typeKo : typeEn;
        }
    });
    
    // ì„¤ëª… ì—…ë°ì´íŠ¸
    document.querySelectorAll('[data-desc-en]').forEach(element => {
        const descEn = element.getAttribute('data-desc-en');
        const descKo = element.getAttribute('data-desc-ko');
        if (descEn && descKo) {
            element.textContent = currentLang === 'ko' ? descKo : descEn;
        }
    });
    
    // ìš”êµ¬ì‚¬í•­ ì—…ë°ì´íŠ¸
    document.querySelectorAll('.job-requirements[data-job-id]').forEach(element => {
        const jobId = element.getAttribute('data-job-id');
        const job = careersData.jobs.find(j => j.id === jobId);
        if (job) {
            const requirementsList = job.requirements[currentLang]
                .map(req => `<li>${req}</li>`)
                .join('');
            element.innerHTML = requirementsList;
        }
    });
    
    // ì§€ì› ë²„íŠ¼ ì—…ë°ì´íŠ¸
    document.querySelectorAll('[data-apply-en]').forEach(element => {
        const applyEn = element.getAttribute('data-apply-en');
        const applyKo = element.getAttribute('data-apply-ko');
        if (applyEn && applyKo) {
            element.textContent = currentLang === 'ko' ? applyKo : applyEn;
        }
    });
}

// CTA ì„¹ì…˜ ì–¸ì–´ ì—…ë°ì´íŠ¸
function updateCTA() {
    const currentLang = window.currentLanguage || localStorage.getItem('language') || 'ko';
    
    document.querySelectorAll('[data-cta-title-en]').forEach(element => {
        const titleEn = element.getAttribute('data-cta-title-en');
        const titleKo = element.getAttribute('data-cta-title-ko');
        if (titleEn && titleKo) {
            element.textContent = currentLang === 'ko' ? titleKo : titleEn;
        }
    });
    
    document.querySelectorAll('[data-cta-desc-en]').forEach(element => {
        const descEn = element.getAttribute('data-cta-desc-en');
        const descKo = element.getAttribute('data-cta-desc-ko');
        if (descEn && descKo) {
            element.textContent = currentLang === 'ko' ? descKo : descEn;
        }
    });
    
    document.querySelectorAll('[data-cta-btn-en]').forEach(element => {
        const btnEn = element.getAttribute('data-cta-btn-en');
        const btnKo = element.getAttribute('data-cta-btn-ko');
        if (btnEn && btnKo) {
            element.textContent = currentLang === 'ko' ? btnKo : btnEn;
        }
    });
}

// ëª¨ë‹¬ ë¼ë²¨ ì–¸ì–´ ì—…ë°ì´íŠ¸
function updateModalLabels() {
    if (!careersData) return;
    
    const currentLang = window.currentLanguage || localStorage.getItem('language') || 'ko';
    
    const modalTitle = document.getElementById('modalJobTitle');
    const labelFullName = document.getElementById('label-fullName');
    const labelEmail = document.getElementById('label-email');
    const labelPhone = document.getElementById('label-phone');
    const labelGithub = document.getElementById('label-github');
    const labelMessage = document.getElementById('label-message');
    const githubInput = document.getElementById('applicantGithub');
    const messageInput = document.getElementById('applicantMessage');
    const submitBtn = document.getElementById('submit-btn');
    const submitBtnText = submitBtn?.querySelector('.btn-text');
    
    if (modalTitle) modalTitle.textContent = careersData.modal.title[currentLang];
    if (labelFullName) labelFullName.textContent = careersData.modal.form.fullName[currentLang];
    if (labelEmail) labelEmail.textContent = careersData.modal.form.email[currentLang];
    if (labelPhone) labelPhone.textContent = careersData.modal.form.phone[currentLang];
    if (labelGithub) labelGithub.textContent = careersData.modal.form.github[currentLang];
    if (labelMessage) labelMessage.textContent = careersData.modal.form.message[currentLang];
    if (githubInput) githubInput.placeholder = careersData.modal.form.githubPlaceholder[currentLang];
    if (messageInput) messageInput.placeholder = careersData.modal.form.messagePlaceholder[currentLang];
    if (submitBtnText) submitBtnText.textContent = careersData.modal.form.submitButton[currentLang];
}

// í´ë°± ì±„ìš© ì„¹ì…˜ ìƒì„± (JSON ë¡œë“œ ì‹¤íŒ¨ ì‹œ)
function createFallbackCareers() {
    const careersGrid = document.getElementById('careers-grid');
    careersGrid.innerHTML = `
        <div class="job-card">
            <h3>AI Research Engineer</h3>
            <div class="job-type">Full-time</div>
            <p>Lead research in foundational AI architectures and neural network optimization.</p>
            <ul class="job-requirements">
                <li>PhD in AI/ML or related field</li>
                <li>5+ years experience in deep learning</li>
                <li>Strong mathematics background</li>
            </ul>
            <button class="apply-btn" onclick="openJobModal('ai-research')">Apply Now</button>
        </div>
    `;
    
    const ctaElement = document.getElementById('careers-cta');
    ctaElement.innerHTML = `
        <h3>Don't see a perfect fit?</h3>
        <p>We're always looking for exceptional talent. Send us your resume!</p>
        <a href="#contact" class="cta-button">Get in Touch</a>
    `;
}

// ì±„ìš© ê³µê³  ëª¨ë‹¬ ì—´ê¸°
function openJobModal(jobId) {
    const modal = document.getElementById('jobModal');
    const jobPosition = document.getElementById('jobPosition');
    const modalTitle = document.getElementById('modalJobTitle');
    
    // ì´ì „ ë©”ì‹œì§€ ë° ë¡œë”© ìƒíƒœ ì´ˆê¸°í™”
    clearJobFormMessage();
    setJobFormLoadingState(false);
    
    if (careersData) {
        const currentLang = window.currentLanguage || localStorage.getItem('language') || 'ko';
        const job = careersData.jobs.find(j => j.id === jobId);
        if (job) {
            modalTitle.textContent = `${careersData.modal.title[currentLang]} - ${job.title[currentLang]}`;
        }
    }
    
    jobPosition.value = jobId;
    modal.style.display = 'block';
}

// ì±„ìš© ê³µê³  ëª¨ë‹¬ ë‹«ê¸°
function closeJobModal() {
    const modal = document.getElementById('jobModal');
    modal.style.display = 'none';
}

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
window.onclick = function(event) {
    const modal = document.getElementById('jobModal');
    if (event.target === modal) {
        modal.style.display = 'none';
    }
}

// ì±„ìš© í¼ ì´ˆê¸°í™” í•¨ìˆ˜ (contact í¼ íŒ¨í„´ ë”°ë¼)
function initializeCareersForm() {
    const jobForm = document.getElementById('jobApplicationForm');
    if (!jobForm) return; // Exit if careers form is not loaded yet

    // ì‹¤ì‹œê°„ ê²€ì¦ (contact í¼ íŒ¨í„´ ë”°ë¼)
    const emailField = document.getElementById('applicantEmail');
    if (emailField) {
        emailField.addEventListener('blur', function() {
            if (this.value && !validateEmail(this.value)) {
                this.style.borderColor = '#EF4444';
            } else {
                this.style.borderColor = 'rgba(59, 130, 246, 0.2)';
            }
        });
    }

    const githubField = document.getElementById('applicantGithub');
    if (githubField) {
        githubField.addEventListener('blur', function() {
            if (this.value && !isValidGitHubURL(this.value)) {
                this.style.borderColor = '#EF4444';
            } else {
                this.style.borderColor = 'rgba(59, 130, 246, 0.2)';
            }
        });
    }

    // ì…ë ¥ ì‹œ ì—ëŸ¬ ìƒíƒœ ì§€ìš°ê¸°
    const formInputs = jobForm.querySelectorAll('.form-input, .form-textarea');
    formInputs.forEach(input => {
        input.addEventListener('input', function() {
            this.style.borderColor = 'rgba(59, 130, 246, 0.2)';
            clearJobFormMessage();
        });
    });

    // í¼ ì œì¶œ í•¸ë“¤ëŸ¬
    jobForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const currentLang = window.currentLanguage || localStorage.getItem('language') || 'ko';
        
        // í¼ ë°ì´í„° ìˆ˜ì§‘
        const formData = new FormData(jobForm);
        const data = {
            position: formData.get('position'),
            name: formData.get('name').trim(),
            email: formData.get('email').trim(),
            phone: formData.get('phone').trim(),
            github: formData.get('github').trim(),
            message: formData.get('message').trim()
        };
        
        // ì´ì „ ë©”ì‹œì§€ ì§€ìš°ê¸°
        clearJobFormMessage();
        
        // ê²€ì¦
        let hasErrors = false;
        
        if (!data.name) {
            const errorMsg = currentLang === 'ko' 
                ? 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'
                : 'Name is required.';
            showJobFormMessage(errorMsg, 'error');
            hasErrors = true;
        }
        
        if (!data.email) {
            const errorMsg = currentLang === 'ko' 
                ? 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'
                : 'Email is required.';
            showJobFormMessage(errorMsg, 'error');
            hasErrors = true;
        } else if (!validateEmail(data.email)) {
            const errorMsg = currentLang === 'ko' 
                ? 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'
                : 'Please enter a valid email format.';
            showJobFormMessage(errorMsg, 'error');
            hasErrors = true;
        }
        
        if (!data.phone) {
            const errorMsg = currentLang === 'ko' 
                ? 'ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'
                : 'Phone number is required.';
            showJobFormMessage(errorMsg, 'error');
            hasErrors = true;
        }
        
        if (!data.github) {
            const errorMsg = currentLang === 'ko' 
                ? 'GitHub í”„ë¡œí•„ ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'
                : 'GitHub profile link is required.';
            showJobFormMessage(errorMsg, 'error');
            hasErrors = true;
        } else if (!isValidGitHubURL(data.github)) {
            const errorMsg = currentLang === 'ko' 
                ? 'ì˜¬ë°”ë¥¸ GitHub í”„ë¡œí•„ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš” (https://github.com/username í˜•ì‹)'
                : 'Please enter a valid GitHub profile URL (format: https://github.com/username)';
            showJobFormMessage(errorMsg, 'error');
            hasErrors = true;
        }
        
        if (!data.message) {
            const errorMsg = currentLang === 'ko' 
                ? 'í•˜ê³ ì‹¶ì€ë§ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'
                : 'Message is required.';
            showJobFormMessage(errorMsg, 'error');
            hasErrors = true;
        }
        
        if (hasErrors) {
            return;
        }
        
        // ì œì¶œ ë²„íŠ¼ ë¡œë”© ìƒíƒœ
        setJobFormLoadingState(true);
        
        try {
            // Form2AI2Email APIë¡œ ì œì¶œ
            const response = await fetch('https://form2ai2email-worker.kilos-network.workers.dev/api/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    form_id: 'b8c3a2d1-5f9e-4c7b-8e6d-2a1b3c4d5e6f', // Careers form UUID
                    data: data
                })
            });
            
            if (response.ok) {
                const successMsg = currentLang === 'ko' 
                    ? 'ì§€ì›ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤! ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.'
                    : 'Application submitted successfully! We will contact you soon.';
                showJobFormMessage(successMsg, 'success');
                
                // 3ì´ˆ í›„ ëª¨ë‹¬ ë‹«ê¸° (ì‚¬ìš©ìê°€ ë©”ì‹œì§€ë¥¼ ë³¼ ì‹œê°„ ì œê³µ)
                setTimeout(() => {
                    closeJobModal();
                    jobForm.reset();
                    clearJobFormMessage();
                }, 3000);
            } else {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
        } catch (error) {
            console.error('Careers form submission error:', error);
            const errorMsg = currentLang === 'ko' 
                ? 'ì§€ì›ì„œ ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
                : 'Failed to submit application. Please try again.';
            showJobFormMessage(errorMsg, 'error');
        } finally {
            // ë²„íŠ¼ ìƒíƒœ ë³µì›
            setJobFormLoadingState(false);
        }
    });
}

// ì´ë©”ì¼ ê²€ì¦ í•¨ìˆ˜ (contact í¼ê³¼ ë™ì¼)
function validateEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

// URL ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
function isValidURL(string) {
    try {
        const url = new URL(string);
        return url.protocol === 'http:' || url.protocol === 'https:';
    } catch (_) {
        return false;
    }
}

// GitHub URL ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
function isValidGitHubURL(string) {
    try {
        const url = new URL(string);
        return url.protocol === 'https:' && 
               url.hostname === 'github.com' && 
               url.pathname.split('/').length >= 2;
    } catch (_) {
        return false;
    }
}

// ì±„ìš© í¼ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜ (contact í¼ íŒ¨í„´ ë”°ë¼)
function showJobFormMessage(message, type) {
    const messageElement = document.getElementById('jobFormMessage');
    if (messageElement) {
        messageElement.textContent = message;
        messageElement.className = `form-message show ${type}`;
        
        // ìë™ ì‚¬ë¼ì§€ê¸° íƒ€ì´ë¨¸
        setTimeout(() => {
            messageElement.classList.remove('show');
        }, 5000);
    }
}

// ì±„ìš© í¼ ë©”ì‹œì§€ ì§€ìš°ê¸° í•¨ìˆ˜
function clearJobFormMessage() {
    const messageElement = document.getElementById('jobFormMessage');
    if (messageElement) {
        messageElement.textContent = '';
        messageElement.className = 'form-message';
        messageElement.classList.remove('show');
    }
}

// ì±„ìš© í¼ ë¡œë”© ìƒíƒœ ì„¤ì • í•¨ìˆ˜ (contact í¼ íŒ¨í„´ ë”°ë¼)
function setJobFormLoadingState(loading) {
    const submitBtn = document.getElementById('submit-btn');
    
    if (submitBtn) {
        if (loading) {
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
        } else {
            submitBtn.disabled = false;
            submitBtn.classList.remove('loading');
        }
    }
}

// ì–¸ì–´ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
document.addEventListener('languageChanged', function(event) {
    updateCareersLanguage();
});

// ì„¹ì…˜ ì´ˆê¸°í™” (HTMX ë™ì  ë¡œë”©ì— ì í•©í•œ íŒ¨í„´)
function initializeCareersSection() {
    console.log('ğŸ¯ Initializing careers section...');
    loadCareersData();
    initializeCareersForm();
}

// ì¦‰ì‹œ ì‹¤í–‰ (HTMX ë¡œë”©ì— ì í•©)
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeCareersSection);
} else {
    initializeCareersSection();
}
</script>
 